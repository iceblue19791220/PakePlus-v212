<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>社保补缴测算工具系统</title>
    <!-- 添加SheetJS库引用 -->
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <!-- 本地字体图标库引用 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c8ac9;
            --primary-dark: #1a5f9e;
            --secondary-color: #9b59b6;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --light-bg: #f8fafc;
            --card-bg: #ffffff;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --border-color: #eaeff5;
            --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 8px 20px rgba(0, 0, 0, 0.08);
            --shadow-heavy: 0 12px 25px rgba(0, 0, 0, 0.15);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f7ff 100%);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            background: linear-gradient(120deg, var(--primary-dark), var(--primary-color));
            color: #fff;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--shadow-heavy);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 70%);
            transform: rotate(30deg);
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.92;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-medium);
            padding: 30px;
            transition: var(--transition);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
            border: 2px solid transparent;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transform: scaleX(0);
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-heavy);
            border-color: var(--primary-color);
        }
        
        .card:hover::before {
            transform: scaleX(1);
        }
        
        .card-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
            color: var(--primary-color);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .card-title {
            font-size: 1.6rem;
            color: var(--primary-dark);
            margin-bottom: 12px;
            font-weight: 600;
        }
        
        .card-description {
            color: var(--text-light);
            font-size: 1rem;
            flex-grow: 1;
            line-height: 1.5;
        }
        
        .card-btn {
            margin-top: 20px;
            padding: 12px 25px;
            background: linear-gradient(120deg, var(--primary-color), var(--primary-dark));
            color: #fff;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow-light);
            position: relative;
            overflow: hidden;
        }
        
        .card-btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: var(--transition);
        }
        
        .card-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(26, 95, 158, 0.35);
        }
        
        .card-btn:hover::before {
            left: 100%;
        }
        
        .tool-section {
            display: none;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-medium);
            padding: 30px;
            margin-bottom: 30px;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .section-title {
            font-size: 1.8rem;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
        }
        
        .section-title i {
            font-size: 1.8rem;
            color: var(--primary-color);
        }
        
        .back-btn {
            background: #95a5a6;
            color: #fff;
            border: none;
            padding: 10px 18px;
            border-radius: 6px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: var(--shadow-light);
        }
        
        .back-btn:hover {
            background: #7f8c8d;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .input-box {
            flex: 1;
            min-width: 160px;
        }
        
        .input-box label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-dark);
            font-size: 1rem;
        }
        
        .input-box input,
        .input-box select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 15px;
            transition: var(--transition);
            background: var(--light-bg);
        }
        
        .input-box input:focus,
        .input-box select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 4px rgba(44, 138, 201, 0.2);
            background: #fff;
        }
        
        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .result-card {
            background: linear-gradient(135deg, #f8fafc 0%, #eaf2f8 100%);
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            transition: var(--transition);
        }
        
        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
        }
        
        .result-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-dark), var(--primary-color));
        }
        
        .result-card h3 {
            font-size: 1.25rem;
            color: var(--text-dark);
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .result-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 5px;
        }
        
        .result-unit {
            font-size: 1rem;
            color: var(--text-light);
            margin-left: 5px;
        }
        
        .total-card {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-color) 100%);
            color: #fff;
        }
        
        .total-card h3,
        .total-card .result-value,
        .total-card .result-unit {
            color: #fff;
        }
        
        .btn {
            background: linear-gradient(120deg, var(--primary-color), var(--primary-dark));
            color: #fff;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-light);
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: var(--transition);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(26, 95, 158, 0.35);
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn-calculate {
            background: linear-gradient(120deg, var(--accent-color), #c0392b);
            width: 100%;
            margin-top: 15px;
            font-size: 17px;
            padding: 16px;
        }
        
        .btn-export {
            background: linear-gradient(120deg, var(--secondary-color), #8e44ad);
            margin-top: 15px;
            width: 100%;
        }
        
        .btn-template {
            background: linear-gradient(120deg, #3498db, #2980b9);
            width: 100%;
            margin-top: 8px;
        }
        
        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            background: var(--light-bg);
            transition: var(--transition);
            cursor: pointer;
        }
        
        .upload-area:hover {
            background: #e6f7ff;
            border-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .upload-area i {
            font-size: 2.5rem;
            color: #3498db;
            margin-bottom: 12px;
        }
        
        .upload-area p {
            font-size: 1rem;
            color: var(--text-light);
            margin-bottom: 12px;
        }
        
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: var(--shadow-light);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .preview-table th {
            background: var(--primary-color);
            color: #fff;
            padding: 12px 15px;
            text-align: left;
            font-weight: 500;
        }
        
        .preview-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .preview-table tr:nth-child(even) {
            background: var(--light-bg);
        }
        
        .preview-table tr:hover {
            background: #e6f7ff;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .status-icon {
            font-size: 1.3rem;
        }
        
        .status-waiting {
            background: #e0f7fa;
            color: #00bcd4;
            border-left: 4px solid #00bcd4;
        }
        
        .status-success {
            background: #e8f5e9;
            color: var(--success-color);
            border-left: 4px solid var(--success-color);
        }
        
        .status-error {
            background: #ffebee;
            color: var(--accent-color);
            border-left: 4px solid var(--accent-color);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-light);
        }
        
        .data-table th {
            background: var(--primary-color);
            color: #fff;
            padding: 12px 15px;
            text-align: left;
        }
        
        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .data-table tr:nth-child(even) {
            background: var(--light-bg);
        }
        
        .data-table tr:hover {
            background: #e6f7ff;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            flex: 1;
            min-width: 180px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text-dark);
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 15px;
        }
        
        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 15px;
        }
        
        .btn-success {
            background: linear-gradient(120deg, var(--success-color), #219653);
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: var(--text-light);
            font-size: 0.9rem;
            padding: 20px 0;
            border-top: 1px solid var(--border-color);
        }
        
        .highlight {
            color: var(--accent-color);
            font-weight: 600;
        }
        
        .date-input {
            text-align: center;
            padding: 12px;
            font-size: 1rem;
            font-weight: 500;
        }
        
        .period-container {
            background: var(--light-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
            transition: var(--transition);
        }
        
        .period-container:hover {
            box-shadow: var(--shadow-light);
        }
        
        .period-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .period-title {
            font-size: 1.1rem;
            color: var(--primary-dark);
            font-weight: 500;
        }
        
        .remove-period {
            background: var(--accent-color);
            color: #fff;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .remove-period:hover {
            background: #c0392b;
            transform: scale(1.1);
        }
        
        .add-period-btn {
            background: var(--primary-color);
            color: #fff;
            border: none;
            padding: 10px 18px;
            border-radius: 6px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 15px;
            box-shadow: var(--shadow-light);
        }
        
        .add-period-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .time-inputs {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .time-input-group {
            display: flex;
            flex: 1;
            min-width: 180px;
            gap: 8px;
        }
        
        .time-input-box {
            flex: 1;
        }
        
        .custom-base-input {
            background: #fff9e6;
            border: 2px solid #ffd700;
        }
        
        .custom-base-input:focus {
            border-color: #ff9800;
            box-shadow: 0 0 0 4px rgba(255, 152, 0, 0.2);
        }
        
        .error-message {
            color: var(--accent-color);
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }
        
        .warning-message {
            background: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 12px;
            margin: 12px 0;
            border-radius: 0 6px 6px 0;
        }
        
        .input-hint {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 4px;
        }
        
        @media (max-width: 1200px) {
            .time-input-group {
                min-width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .results {
                grid-template-columns: 1fr;
            }
            
            header h1 {
                font-size: 1.8rem;
            }
            
            .card-title {
                font-size: 1.4rem;
            }
            
            .time-input-box {
                min-width: 45%;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .back-btn {
                align-self: flex-end;
            }
        }
        
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        #custom-base-tool .time-input-box input {
            width: 90px;
            min-width: 80px;
            padding: 10px;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            #custom-base-tool .time-input-box input {
                width: 100%;
                min-width: auto; 
            }
        }
        
        /* 系统信息样式 */
        .system-info {
            background: #e8f5e9;
            border-left: 4px solid var(--success-color);
            padding: 12px 15px;
            border-radius: 0 8px 8px 0;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .system-info i {
            color: var(--success-color);
            font-size: 1.2rem;
        }
        
        .offline-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--success-color);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .storage-info {
            background: #e3f2fd;
            border-left: 4px solid var(--primary-color);
            padding: 12px 15px;
            border-radius: 0 8px 8px 0;
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .storage-info i {
            color: var(--primary-color);
            font-size: 1.2rem;
        }
        
        /* 新增样式 */
        .system-data-row {
            background-color: #f0f9ff !important;
        }
        
        .edit-system-btn {
            background: linear-gradient(120deg, var(--warning-color), #e67e22);
            padding: 8px 12px;
            font-size: 0.85rem;
        }
        
        .reset-system-btn {
            background: linear-gradient(120deg, var(--accent-color), #c0392b);
            margin-top: 15px;
        }
        
        .editable-input {
            background: #fff9e6;
            border: 1px solid #ffd700;
            padding: 4px 8px;
            border-radius: 4px;
            width: 80px;
        }
        
        /* 模态框样式 */
        .modal-overlay {
             position: fixed;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             background-color: rgba(0, 0, 0, 0.5);
             display: flex;
             justify-content: center;
             align-items: center;
             z-index: 2000;
             visibility: hidden;
             opacity: 0;
             transition: var(--transition);
        }
        
        .modal-overlay.active {
            visibility: visible;
            opacity: 1;
        }
        
        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-heavy);
            width: 90%;
            max-width: 500px;
            padding: 25px;
            transform: translateY(-50px);
            transition: transform 0.3s ease;
            user-select: auto !important;
            pointer-events: auto !important;
        }
        
        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .modal-title {
            font-size: 1.4rem;
            color: var(--primary-dark);
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .modal-close:hover {
            color: var(--accent-color);
        }
        
        .modal-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .modal-form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .modal-form-group label {
            font-weight: 500;
            color: var(--text-dark);
        }
        
        .modal-form-group input {
            padding: 10px 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 15px;
            transition: var(--transition);
        }
        
        .modal-form-group input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 4px rgba(44, 138, 201, 0.2);
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 20px;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }
        
        .modal-btn-cancel {
            background: #95a5a6;
            color: white;
        }
        
        .modal-btn-cancel:hover {
            background: #7f8c8d;
        }
        
        .modal-btn-confirm {
            background: linear-gradient(120deg, var(--primary-color), var(--primary-dark));
            color: white;
        }
        
        .modal-btn-confirm:hover {
            background: linear-gradient(120deg, var(--primary-dark), var(--primary-color));
        }
        
        .modal-form-group-full {
            grid-column: 1 / -1;
        }
        
        @media (max-width: 768px) {
            .modal-form {
                grid-template-columns: 1fr;
            }
        }

        /* 工伤保险特有样式 */
        .injury-period-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: flex-end;
        }
        
        .injury-period-inputs {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 10px;
        }
        
        @media (max-width: 768px) {
            .injury-period-inputs {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .injury-period-inputs {
                grid-template-columns: 1fr;
            }
        }
        
        .injury-remove-period {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
            white-space: nowrap;
            height: fit-content;
        }
        
        .injury-remove-period:hover {
            background-color: #c0392b;
        }
        
        .injury-add-period {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 6px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 15px;
            box-shadow: var(--shadow-light);
        }
        
        .injury-add-period:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .injury-period-summary {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            display: none;
        }
        
        .injury-period-summary h4 {
            margin-bottom: 10px;
            color: var(--text-dark);
        }
        
        .injury-month-list {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: white;
            border-radius: 4px;
        }
        
        .injury-month-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            gap: 10px;
        }
        
        .injury-month-item:last-child {
            border-bottom: none;
        }
        
        @media (max-width: 768px) {
            .injury-month-item {
                grid-template-columns: 1fr;
                gap: 5px;
                text-align: center;
            }
        }
        
        .injury-summary-header {
            font-weight: 600;
            background-color: #f1f1f1;
        }
        
        .injury-no-data {
            text-align: center;
            padding: 20px;
            color: var(--text-light);
            font-style: italic;
        }
        
        /* 新增美化元素 */
        .feature-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .card-content {
            position: relative;
            width: 100%;
        }
        
        .stats-preview {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            width: 100%;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--text-light);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .progress-bar {
            height: 6px;
            background-color: #e0e0e0;
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 3px;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="loader" id="loader">
        <div class="loader-spinner"></div>
        <p style="margin-top:15px;font-size:1.1rem;color:#1a5f9e;">系统加载中，请稍候...</p>
    </div>

    <!-- 编辑数据模态框 -->
    <div class="modal-overlay" id="edit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">编辑缴费数据</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-form">
                <div class="modal-form-group">
                    <label for="edit-year">年度</label>
                    <input type="number" id="edit-year" min="1990" max="2050" placeholder="请输入年度">
                </div>
                <div class="modal-form-group">
                    <label for="edit-start-month">开始月份</label>
                    <input type="number" id="edit-start-month" min="1" max="12" placeholder="开始月份">
                </div>
                <div class="modal-form-group">
                    <label for="edit-end-month">结束月份</label>
                    <input type="number" id="edit-end-month" min="1" max="12" placeholder="结束月份">
                </div>
                <div class="modal-form-group modal-form-group-full">
                    <label for="edit-base">月缴费基数</label>
                    <input type="number" id="edit-base" min="0" step="1" placeholder="请输入月缴费基数">
                </div>
                <div class="modal-form-group">
                    <label for="edit-unit-rate">单位比例 (%)</label>
                    <input type="number" id="edit-unit-rate" min="0" max="100" step="0.01" placeholder="请输入单位比例">
                </div>
                <div class="modal-form-group">
                    <label for="edit-personal-rate">个人比例 (%)</label>
                    <input type="number" id="edit-personal-rate" min="0" max="100" step="0.01" placeholder="请输入个人比例">
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel">取消</button>
                <button class="modal-btn modal-btn-confirm">确认</button>
                <button class="modal-btn modal-btn-delete" id="modal-delete-btn" style="display: none; background: #e74c3c;">删除</button>
            </div>
        </div>
    </div>

    <div class="container" style="display:none;" id="main-container">
        <header>
            <h1><i class="fas fa-calculator"></i> 社保补缴测算工具系统</h1>
            <p>程序仅为解决内部社保补缴测算需求，结果仅供参考</p>
        </header>
        
        <div id="dashboard" class="dashboard">
            <div class="card" data-tool="single-tool">
                <div class="card-content">
                    <span class="feature-badge">常用工具</span>
                    <div class="card-icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <h2 class="card-title">按缴费档次补缴测算工具</h2>
                    <p class="card-description">
                        提供按档次60%-300%补缴养老保险补缴计算，支持多时间段补缴测算。
                    </p>
                    <div class="stats-preview">
                        <div class="stat-item">
                            <div class="stat-value">60%-300%</div>
                            <div class="stat-label">缴费比例</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">多时段</div>
                            <div class="stat-label">支持模式</div>
                        </div>
                    </div>
                    <button class="card-btn">进入工具 <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
            
            <div class="card" data-tool="batch-tool">
                <div class="card-content">
                    <span class="feature-badge">批量处理</span>
                    <div class="card-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h2 class="card-title">按缴费档次批量计算工具</h2>
                    <p class="card-description">
                        使用Excel/CSV模板批量计算多人相同档次补缴费用。支持数据上传和结果导出功能。
                    </p>
                    <div class="stats-preview">
                        <div class="stat-item">
                            <div class="stat-value">Excel/CSV</div>
                            <div class="stat-label">文件格式</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">批量</div>
                            <div class="stat-label">高效处理</div>
                        </div>
                    </div>
                    <button class="card-btn">进入工具 <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
            
            <div class="card" data-tool="custom-base-tool">
                <div class="card-content">
                    <span class="feature-badge">灵活设置</span>
                    <div class="card-icon">
                        <i class="fas fa-sliders-h"></i>
                    </div>
                    <h2 class="card-title">自定义基数补缴计算工具</h2>
                    <p class="card-description">
                        为每个时间段指定缴费基数进行补缴计算，提供更灵活的缴费方案。
                    </p>
                    <div class="stats-preview">
                        <div class="stat-item">
                            <div class="stat-value">自定义</div>
                            <div class="stat-label">缴费基数</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">灵活</div>
                            <div class="stat-label">方案定制</div>
                        </div>
                    </div>
                    <button class="card-btn">进入工具 <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
            
            <div class="card" data-tool="injury-insurance-tool">
                <div class="card-content">
                    <span class="feature-badge">工伤保险</span>
                    <div class="card-icon">
                        <i class="fas fa-ambulance"></i>
                    </div>
                    <h2 class="card-title">工伤保险补缴计算工具</h2>
                    <p class="card-description">
                        工伤保险补缴与滞纳金计算，支持多时间段输入和详细计算明细。
                    </p>
                    <div class="stats-preview">
                        <div class="stat-item">
                            <div class="stat-value">工伤</div>
                            <div class="stat-label">保险类型</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">明细</div>
                            <div class="stat-label">详细计算</div>
                        </div>
                    </div>
                    <button class="card-btn">进入工具 <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
            
            <div class="card" data-tool="data-management">
                <div class="card-content">
                    <span class="feature-badge">数据管理</span>
                    <div class="card-icon">
                        <i class="fas fa-database"></i>
                    </div>
                    <h2 class="card-title">数据维护</h2>
                    <p class="card-description">
                        管理养老保险缴费基数数据，添加、修改或删除年度缴费信息。
                    </p>
                    <div class="stats-preview">
                        <div class="stat-item">
                            <div class="stat-value">数据</div>
                            <div class="stat-label">系统维护</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">历史</div>
                            <div class="stat-label">数据管理</div>
                        </div>
                    </div>
                    <button class="card-btn">进入管理 <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
        </div>
        
        <!-- 养老保险单条测算工具 -->
        <div id="single-tool" class="tool-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-user"></i> 缴费档次补缴测算工具
                </h2>
                <button class="back-btn">
                    <i class="fas fa-arrow-left"></i> 返回主菜单
                </button>
            </div>
            
            <div id="single-tool-content">
                <!-- 添加当前时间设置 -->
                <div class="input-group">
                    <div class="input-box">
                        <label for="single-current-year">当前年份（用于计算滞纳金）</label>
                        <input type="number" id="single-current-year" min="1990" max="2050" class="date-input year-input" maxlength="4">
                    </div>
                    <div class="input-box">
                        <label for="single-current-month">当前月份</label>
                        <input type="number" id="single-current-month" min="1" max="12" class="date-input month-input" maxlength="2">
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-box">
                        <label for="base-percent">缴费基数比例（%）</label>
                        <input type="number" id="base-percent" min="60" max="300" step="1" value="100">
                        <p class="input-hint">输入60-300之间的数值，表示基数的百分比</p>
                    </div>
                </div>
                
                <div id="periods-container">
                    <div class="period-container" id="period-1">
                        <div class="period-header">
                            <div class="period-title">补缴时间段 #1</div>
                            <button class="remove-period" style="display: none;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="time-inputs">
                            <div class="time-input-group">
                                <div class="time-input-box">
                                    <label for="start-year-1">开始年份</label>
                                    <input type="number" id="start-year-1"min="1990" max="2050" value="1996" class="date-input year-input" maxlength="4">
                                </div>
                                <div class="time-input-box">
                                    <label for="start-month-1">开始月份</label>
                                    <input type="number" id="start-month-1" min="1" max="12" value="1" class="date-input month-input" maxlength="2">
                                </div>
                            </div>
                            <div class="time-input-group">
                                <div class="time-input-box">
                                    <label for="end-year-1">结束年份</label>
                                    <input type="number" id="end-year-1"min="1990" max="2050" value="2000" class="date-input year-input" maxlength="4">
                                </div>
                                <div class="time-input-box">
                                    <label for="end-month-1">结束月份</label>
                                    <input type="number" id="end-month-1" min="1" max="12" value="12" class="date-input month-input" maxlength="2">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button class="add-period-btn">
                    <i class="fas fa-plus"></i> 添加时间段
                </button>
                
                <button class="btn btn-calculate">
                    <i class="fas fa-calculator"></i> 计算补缴金额
                </button>
                
                <div class="results" id="single-results">
                    <div class="result-card">
                        <h3>单位应缴部分</h3>
                        <div class="result-value" id="unit-payment">0.00<span class="result-unit">元</span></div>
                    </div>
                    
                    <div class="result-card">
                        <h3>个人应缴部分</h3>
                        <div class="result-value" id="personal-payment">0.00<span class="result-unit">元</span></div>
                    </div>
                    
                    <div class="result-card">
                        <h3>滞纳金</h3>
                        <div class="result-value" id="late-fee">0.00<span class="result-unit">元</span></div>
                    </div>
                    
                    <div class="result-card total-card">
                        <h3>总计应缴金额</h3>
                        <div class="result-value" id="total-payment">0.00<span class="result-unit">元</span></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 养老保险批量测算工具 -->
        <div id="batch-tool" class="tool-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-users"></i>缴费档次批量计算工具
                </h2>
                <button class="back-btn">
                    <i class="fas fa-arrow-left"></i> 返回主菜单
                </button>
            </div>
            
            <div id="batch-tool-content">
                <!-- 添加当前时间设置 -->
                <div class="input-group">
                    <div class="input-box">
                        <label for="batch-current-year">当前年份（用于计算滞纳金）</label>
                        <input type="number" id="batch-current-year" min="1990" max="2050" class="date-input year-input" maxlength="4">
                    </div>
                    <div class="input-box">
                        <label for="batch-current-month">当前月份</label>
                        <input type="number" id="batch-current-month" min="1" max="12" class="date-input month-input" maxlength="2">
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-box">
                        <button class="btn btn-template" id="download-template-btn">
                            <i class="fas fa-download"></i> 下载Excel模板
                        </button>
                    </div>
                    <div class="input-box">
                        <div class="upload-area" id="upload-area">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>点击或拖拽Excel/CSV文件到此处上传</p>
                            <p class="highlight">支持.xlsx, .xls, .csv格式</p>
                        </div>
                        <input type="file" id="file-input" accept=".xlsx,.xls,.csv" style="display: none;">
                    </div>
                </div>
                
                <div id="upload-status" class="status-indicator status-waiting">
                    <i class="fas fa-sync-alt status-icon"></i>
                    <span>等待上传Excel/CSV文件</span>
                </div>
                
                <div class="input-group">
                    <div class="input-box">
                        <label for="batch-base-percent">缴费基数比例（%）</label>
                        <input type="number" id="batch-base-percent" min="60" max="300" step="1" value="100">
                    </div>
                </div>
                
                <button class="btn btn-calculate" id="batch-calculate-btn" disabled>
                    <i class="fas fa-calculator"></i> 批量计算
                </button>
                
                <div id="batch-results" style="display: none; margin-top: 30px;">
                    <div class="status-indicator status-success">
                        <i class="fas fa-check-circle status-icon"></i>
                        <span>计算完成！共处理了 <span id="record-count">0</span> 条记录</span>
                    </div>
                    
                    <button class="btn btn-export" id="export-results-btn">
                        <i class="fas fa-file-export"></i> 导出计算结果
                    </button>
                    
                    <div style="overflow-x: auto; margin-top: 20px;">
                        <table class="preview-table">
                            <thead>
                                <tr>
                                    <th>姓名</th>
                                    <th>补缴时间段</th>
                                    <th>单位应缴</th>
                                    <th>个人应缴</th>
                                    <th>滞纳金</th>
                                    <th>总计</th>
                                </tr>
                            </thead>
                            <tbody id="results-table-body">
                                <!-- 计算结果将在这里显示 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 养老保险自定义基数工具 -->
        <div id="custom-base-tool" class="tool-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-sliders-h"></i> 自定义基数养老保险补缴工具
                </h2>
                <button class="back-btn">
                    <i class="fas fa-arrow-left"></i> 返回主菜单
                </button>
            </div>
            
            <div id="custom-base-tool-content">
                <div class="warning-message">
                    <i class="fas fa-exclamation-triangle"></i> 
                    此工具可为多个时间段指定缴费基数，程序未限定基数上下限和缴费区间，输入应遵循基本规则。
                </div>
                
                <!-- 添加当前时间设置 -->
                <div class="input-group">
                    <div class="input-box">
                        <label for="custom-current-year">当前年份（用于计算滞纳金）</label>
                        <input type="number" id="custom-current-year" min="1990" max="2050" class="date-input year-input" maxlength="4">
                    </div>
                    <div class="input-box">
                        <label for="custom-current-month">当前月份</label>
                        <input type="number" id="custom-current-month" min="1" max="12" class="date-input month-input" maxlength="2">
                    </div>
                </div>
                
                <div id="custom-periods-container">
                    <div class="period-container" id="custom-period-1">
                        <div class="period-header">
                            <div class="period-title">补缴时间段 #1</div>
                            <button class="remove-period" style="display: none;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="time-inputs">
                            <div class="time-input-group">
                                <div class="time-input-box">
                                    <label for="custom-start-year-1">开始年份</label>
                                    <input type="number" id="custom-start-year-1"min="1990" max="2050" value="2020" class="date-input year-input" maxlength="4">
                                </div>
                                <div class="time-input-box">
                                    <label for="custom-start-month-1">开始月份</label>
                                    <input type="number" id="custom-start-month-1" min="1" max="12" value="1" class="date-input month-input" maxlength="2">
                                </div>
                            </div>
                            <div class="time-input-group">
                                <div class="time-input-box">
                                    <label for="custom-end-year-1">结束年份</label>
                                    <input type="number" id="custom-end-year-1"min="1990" max="2050" value="2020" class="date-input year-input" maxlength="4">
                                </div>
                                <div class="time-input-box">
                                    <label for="custom-end-month-1">结束月份</label>
                                    <input type="number" id="custom-end-month-1" min="1" max="12" value="12" class="date-input month-input" maxlength="2">
                                </div>
                            </div>
                            <div class="time-input-group">
                                <div class="time-input-box">
                                    <label for="custom-base-1">月缴费基数（元）</label>
                                    <input type="number" id="custom-base-1" min="1000" step="100" value="5000" class="custom-base-input">
                                </div>
                            </div>
                        </div>
                        <div class="error-message" id="custom-period-error-1"></div>
                    </div>
                </div>
                
                <button class="add-period-btn">
                    <i class="fas fa-plus"></i> 添加时间段
                </button>
                
                <button class="btn btn-calculate">
                    <i class="fas fa-calculator"></i> 计算补缴金额
                </button>
                
                <div class="results" id="custom-results">
                    <div class="result-card">
                        <h3>单位应缴部分</h3>
                        <div class="result-value" id="custom-unit-payment">0.00<span class="result-unit">元</span></div>
                    </div>
                    
                    <div class="result-card">
                        <h3>个人应缴部分</h3>
                        <div class="result-value" id="custom-personal-payment">0.00<span class="result-unit">元</span></div>
                    </div>
                    
                    <div class="result-card">
                        <h3>滞纳金</h3>
                        <div class="result-value" id="custom-late-fee">0.00<span class="result-unit">元</span></div>
                    </div>
                    
                    <div class="result-card total-card">
                        <h3>总计应缴金额</h3>
                        <div class="result-value" id="custom-total-payment">0.00<span class="result-unit">元</span></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 工伤保险补缴工具 -->
        <div id="injury-insurance-tool" class="tool-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-ambulance"></i> 工伤保险补缴计算工具
                </h2>
                <button class="back-btn">
                    <i class="fas fa-arrow-left"></i> 返回主菜单
                </button>
            </div>
            
            <div id="injury-insurance-tool-content">
                <div class="warning-message">
                    <i class="fas fa-exclamation-triangle"></i> 
                    工伤保险补缴计算工具，支持多时间段输入，自动计算补缴金额和滞纳金。
                </div>
                
                <!-- 修改后的当前月份输入方式 -->
                <div class="input-group">
                    <div class="input-box">
                        <label for="injury-current-year">当前年份（用于计算滞纳金）</label>
                        <input type="number" id="injury-current-year" min="1990" max="2050" value="2024" class="date-input year-input" maxlength="4">
                    </div>
                    <div class="input-box">
                        <label for="injury-current-month">当前月份</label>
                        <input type="number" id="injury-current-month" min="1" max="12" value="12" class="date-input month-input" maxlength="2">
                    </div>
                </div>
                
                <!-- 修改后的时间段输入方式 -->
                <div class="form-group">
                    <label>补缴时间段设置：</label>
                    <div id="injuryPeriodsContainer">
                        <div class="injury-period-row">
                            <div class="injury-period-inputs">
                                <div class="time-input-group">
                                    <div class="time-input-box">
                                        <label for="injury-start-year-1">开始年份</label>
                                        <input type="number" id="injury-start-year-1" min="1990" max="2050" value="2023" class="date-input year-input" maxlength="4">
                                    </div>
                                    <div class="time-input-box">
                                        <label for="injury-start-month-1">开始月份</label>
                                        <input type="number" id="injury-start-month-1" min="1" max="12" value="1" class="date-input month-input" maxlength="2">
                                    </div>
                                </div>
                                <div class="time-input-group">
                                    <div class="time-input-box">
                                        <label for="injury-end-year-1">结束年份</label>
                                        <input type="number" id="injury-end-year-1" min="1990" max="2050" value="2023" class="date-input year-input" maxlength="4">
                                    </div>
                                    <div class="time-input-box">
                                        <label for="injury-end-month-1">结束月份</label>
                                        <input type="number" id="injury-end-month-1" min="1" max="12" value="12" class="date-input month-input" maxlength="2">
                                    </div>
                                </div>
                                <div class="time-input-group">
                                    <div class="time-input-box">
                                        <label for="injury-base-1">缴费基数</label>
                                        <input type="number" id="injury-base-1" class="injury-period-base" min="0" step="0.01" placeholder="例如：5000" value="5000" required>
                                    </div>
                                    <div class="time-input-box">
                                        <label for="injury-rate-1">征缴比例 (%)</label>
                                        <input type="number" id="injury-rate-1" class="injury-period-rate" min="0" max="10" step="0.01" placeholder="例如：0.5" value="0.5" required>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="injury-remove-period">删除</button>
                        </div>
                    </div>
                    
                    <button type="button" class="injury-add-period" id="injuryAddPeriod">
                        <i class="fas fa-plus"></i> 添加时间段
                    </button>
                </div>
                
                <button class="btn btn-calculate" id="injuryCalculateBtn">
                    <i class="fas fa-calculator"></i> 计算补缴金额与滞纳金
                </button>
                
                <div class="results" id="injury-results">
                    <div class="result-card">
                        <h3>补缴月数</h3>
                        <div class="result-value" id="injury-monthsCount">0</div>
                    </div>
                    
                    <div class="result-card">
                        <h3>应补缴金额</h3>
                        <div class="result-value" id="injury-totalAmount">0.00<span class="result-unit">元</span></div>
                    </div>
                    
                    <div class="result-card">
                        <h3>滞纳金金额</h3>
                        <div class="result-value" id="injury-lateFee">0.00<span class="result-unit">元</span></div>
                    </div>
                    
                    <div class="result-card total-card">
                        <h3>合计应缴金额</h3>
                        <div class="result-value" id="injury-totalPayment">0.00<span class="result-unit">元</span></div>
                    </div>
                </div>
                
                <div class="injury-period-summary" id="injuryPeriodSummary">
                    <h4>各月明细</h4>
                    <div class="injury-month-list" id="injuryMonthList">
                        <div class="injury-month-item injury-summary-header">
                            <span>月份</span>
                            <span>缴费基数</span>
                            <span>征缴比例</span>
                            <span>补缴金额</span>
                            <span>滞纳金</span>
                        </div>
                        <div class="injury-no-data">暂无数据，请先计算</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 数据维护工具 -->
        <div id="data-management" class="tool-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-database"></i> 养老保险数据维护
                </h2>
                <button class="back-btn">
                    <i class="fas fa-arrow-left"></i> 返回主菜单
                </button>
            </div>
            
            <div id="data-management-content">
                <div class="system-info">
                    <i class="fas fa-info-circle"></i>
                    <span>若出现各年度数据混乱、无法删除等问题，请尝试使用"重置系统数据"和"清除缓存"功能修正</span>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3><i class="fas fa-list"></i> 当前缴费数据</h3>
                    <button class="btn btn-success" id="add-data-btn">
                        <i class="fas fa-plus"></i> 添加新数据
                    </button>
                </div>
                
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>年度</th>
                                <th>开始月份</th>
                                <th>结束月份</th>
                                <th>月缴费基数</th>
                                <th>单位比例</th>
                                <th>个人比例</th>
                                <th>数据类型</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="data-table-body">
                            <!-- 数据将通过JavaScript填充 -->
                        </tbody>
                    </table>
                </div>
                
                <div style="display: flex; margin-top: 20px;">
            <button class="btn reset-system-btn" id="reset-system-data-btn">
                <i class="fas fa-undo"></i> 重置系统数据
            </button>
            <button class="btn reset-system-btn" id="clear-cache-btn" style="background: linear-gradient(120deg, #95a5a6, #7f8c8d); margin-left: 10px;">
                <i class="fas fa-trash"></i> 清除缓存
            </button>
        </div>
    </div>
</div>
                
            </div>
        </div>
        
        <footer>
            <p> 程序由DeepSeek R1创作 by 5925894@qq.com | 数据更新日期：<span id="data-update-date"></span></p>
        </footer>
    </div>

    <script>
        // 主应用代码
        document.addEventListener('DOMContentLoaded', function() {
            // 显示加载器
            document.getElementById('loader').style.display = 'flex';
            
            // 初始化应用
            setTimeout(() => {
                initApp();
                document.getElementById('loader').style.display = 'none';
                document.getElementById('main-container').style.display = 'block';
            }, 500);
            
            function initApp() {
                // 页面导航函数
                function showDashboard() {
                    document.getElementById('dashboard').style.display = 'grid';
                    document.getElementById('single-tool').style.display = 'none';
                    document.getElementById('batch-tool').style.display = 'none';
                    document.getElementById('custom-base-tool').style.display = 'none';
                    document.getElementById('injury-insurance-tool').style.display = 'none';
                    document.getElementById('data-management').style.display = 'none';
                }
                
                function showTool(toolId) {
                    document.getElementById('dashboard').style.display = 'none';
                    document.getElementById('single-tool').style.display = 'none';
                    document.getElementById('batch-tool').style.display = 'none';
                    document.getElementById('custom-base-tool').style.display = 'none';
                    document.getElementById('injury-insurance-tool').style.display = 'none';
                    document.getElementById('data-management').style.display = 'none';
                    
                    document.getElementById(toolId).style.display = 'block';
                    
                    // 如果打开数据维护界面，更新表格
                    if (toolId === 'data-management') {
                        updateDataTable();
                    }
                }
                
                // 修复卡片点击功能
                function setupCardNavigation() {
                    const cards = document.querySelectorAll('.card');
                    cards.forEach(card => {
                        card.addEventListener('click', function() {
                            const toolId = this.getAttribute('data-tool');
                            showTool(toolId);
                        });
                    });
                }
                
                // 修复返回按钮功能
                function setupBackButtons() {
                    const backButtons = document.querySelectorAll('.back-btn');
                    backButtons.forEach(button => {
                        button.addEventListener('click', showDashboard);
                    });
                }
                
                // 默认显示仪表盘
                showDashboard();
                
                // 修复卡片导航功能
                setupCardNavigation();
                
                // 修复返回按钮功能
                setupBackButtons();
                
                // 养老保险缴费数据（1996-2025）
                const defaultSystemData = [
                    {year: 1996, startMonth: 1, endMonth: 12, base: 341, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 1997, startMonth: 1, endMonth: 12, base: 361, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 1998, startMonth: 1, endMonth: 12, base: 389, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 1999, startMonth: 1, endMonth: 12, base: 421, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 2000, startMonth: 1, endMonth: 12, base: 445, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 2001, startMonth: 1, endMonth: 12, base: 472, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 2002, startMonth: 1, endMonth: 12, base: 579, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 2003, startMonth: 1, endMonth: 12, base: 614, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 2004, startMonth: 1, endMonth: 12, base: 668, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 2005, startMonth: 1, endMonth: 12, base: 730, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 2006, startMonth: 1, endMonth: 12, base: 787, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 2007, startMonth: 1, endMonth: 12, base: 886, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 2008, startMonth: 1, endMonth: 12, base: 1100, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 2009, startMonth: 1, endMonth: 12, base: 1267, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 2010, startMonth: 1, endMonth: 12, base: 1469, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 2011, startMonth: 1, endMonth: 12, base: 1789, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 2012, startMonth: 1, endMonth: 12, base: 2127, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 2013, startMonth: 1, endMonth: 12, base: 2348, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 2014, startMonth: 1, endMonth: 12, base: 2634, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 2015, startMonth: 1, endMonth: 12, base: 2971, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 2016, startMonth: 1, endMonth: 4, base: 3276, unitRate: 0.20, personalRate: 0.08, isSystem: true},
                    {year: 2016, startMonth: 5, endMonth: 12, base: 3276, unitRate: 0.19, personalRate: 0.08, isSystem: true},
                    {year: 2017, startMonth: 1, endMonth: 12, base: 3556, unitRate: 0.19, personalRate: 0.08, isSystem: true},
                    {year: 2018, startMonth: 1, endMonth: 12, base: 3758, unitRate: 0.19, personalRate: 0.08, isSystem: true},
                    {year: 2019, startMonth: 1, endMonth: 4, base: 4500, unitRate: 0.19, personalRate: 0.08, isSystem: true},
                    {year: 2019, startMonth: 5, endMonth: 12, base: 4500, unitRate: 0.16, personalRate: 0.08, isSystem: true},
                    {year: 2020, startMonth: 1, endMonth: 12, base: 5000, unitRate: 0.16, personalRate: 0.08, isSystem: true},
                    {year: 2021, startMonth: 1, endMonth: 12, base: 5000, unitRate: 0.16, personalRate: 0.08, isSystem: true},
                    {year: 2022, startMonth: 1, endMonth: 6, base: 5300, unitRate: 0.16, personalRate: 0.08, isSystem: true},
                    {year: 2022, startMonth: 7, endMonth: 12, base: 5750, unitRate: 0.16, personalRate: 0.08, isSystem: true},
                    {year: 2023, startMonth: 1, endMonth: 6, base: 5750, unitRate: 0.16, personalRate: 0.08, isSystem: true},
                    {year: 2023, startMonth: 7, endMonth: 12, base: 6300, unitRate: 0.16, personalRate: 0.08, isSystem: true},
                    {year: 2024, startMonth: 1, endMonth: 6, base: 6300, unitRate: 0.16, personalRate: 0.08, isSystem: true},
                    {year: 2024, startMonth: 7, endMonth: 12, base: 6805, unitRate: 0.16, personalRate: 0.08, isSystem: true},
                    {year: 2025, startMonth: 1, endMonth: 6, base: 6805, unitRate: 0.16, personalRate: 0.08, isSystem: true},
					{year: 2025, startMonth: 7, endMonth: 12, base: 7154, unitRate: 0.16, personalRate: 0.08, isSystem: true},
					{year: 2026, startMonth: 1, endMonth: 6, base: 7154, unitRate: 0.16, personalRate: 0.08, isSystem: true}
                ];
                
                /// 加载所有数据（系统数据和自定义数据）
                let allData = [];
                const loadAllData = () => {
                    const savedData = localStorage.getItem('pension_all_data');
                    if (savedData) {
                        try {
                            allData = JSON.parse(savedData);
                        } catch (e) {
                            console.error('加载数据失败:', e);
                            allData = [...defaultSystemData];
                            saveAllData();
                        }
                    } else {
                        // 如果没有保存的数据，使用默认系统数据
                        allData = [...defaultSystemData];
                        saveAllData();
                    }
                };
                
                // 保存所有数据到本地存储
                const saveAllData = () => {
                    localStorage.setItem('pension_all_data', JSON.stringify(allData));
                };
                
                // 初始化时加载数据
                loadAllData();
                
                // 上传的文件数据
                let uploadedData = [];
                let processedResults = [];
                let periodCounter = 1;
                let customPeriodCounter = 1;
                
                // 当前编辑的数据索引和模式
                let currentEditIndex = -1;
                let isAddingNew = false;
                
                // 设置默认当前时间
                const today = new Date();
                const currentYear = today.getFullYear();
                const currentMonth = today.getMonth() + 1;
                
                // 设置单条测算工具的当前时间
                document.getElementById('single-current-year').value = currentYear;
                document.getElementById('single-current-month').value = currentMonth;
                
                // 设置批量测算工具的当前时间
                document.getElementById('batch-current-year').value = currentYear;
                document.getElementById('batch-current-month').value = currentMonth;
                
                // 设置自定义基数工具的当前时间
                document.getElementById('custom-current-year').value = currentYear;
                document.getElementById('custom-current-month').value = currentMonth;
                
                // 为当前年月输入框添加变化事件监听，自动重新计算
                function setupCurrentDateListeners() {
                    // 单条测算工具的当前年月监听
                    document.getElementById('single-current-year').addEventListener('change', calculateSingle);
                    document.getElementById('single-current-month').addEventListener('change', calculateSingle);
                    
                    // 自定义基数工具的当前年月监听
                    document.getElementById('custom-current-year').addEventListener('change', calculateCustomBase);
                    document.getElementById('custom-current-month').addEventListener('change', calculateCustomBase);
                    
                    // 批量测算工具的当前年月监听（需要重新计算时启用计算按钮）
                    document.getElementById('batch-current-year').addEventListener('change', function() {
                        if (uploadedData.length > 0) {
                            document.getElementById('batch-calculate-btn').disabled = false;
                            // 隐藏之前的结果
                            document.getElementById('batch-results').style.display = 'none';
                        }
                    });
                    document.getElementById('batch-current-month').addEventListener('change', function() {
                        if (uploadedData.length > 0) {
                            document.getElementById('batch-calculate-btn').disabled = false;
                            // 隐藏之前的结果
                            document.getElementById('batch-results').style.display = 'none';
                        }
                    });
                    
                    // 工伤保险工具的当前年月监听
                    document.getElementById('injury-current-year').addEventListener('change', function() {
                        // 触发工伤保险重新计算
                        const calculateBtn = document.getElementById('injuryCalculateBtn');
                        if (calculateBtn) {
                            // 这里可以添加工伤保险的重新计算逻辑
                            // 暂时先清空结果
                            document.getElementById('injury-monthsCount').textContent = '0';
                            document.getElementById('injury-totalAmount').innerHTML = '0.00<span class="result-unit">元</span>';
                            document.getElementById('injury-lateFee').innerHTML = '0.00<span class="result-unit">元</span>';
                            document.getElementById('injury-totalPayment').innerHTML = '0.00<span class="result-unit">元</span>';
                            document.getElementById('injuryPeriodSummary').style.display = 'none';
                        }
                    });
                    document.getElementById('injury-current-month').addEventListener('change', function() {
                        // 触发工伤保险重新计算
                        const calculateBtn = document.getElementById('injuryCalculateBtn');
                        if (calculateBtn) {
                            // 这里可以添加工伤保险的重新计算逻辑
                            // 暂时先清空结果
                            document.getElementById('injury-monthsCount').textContent = '0';
                            document.getElementById('injury-totalAmount').innerHTML = '0.00<span class="result-unit">元</span>';
                            document.getElementById('injury-lateFee').innerHTML = '0.00<span class="result-unit">元</span>';
                            document.getElementById('injury-totalPayment').innerHTML = '0.00<span class="result-unit">元</span>';
                            document.getElementById('injuryPeriodSummary').style.display = 'none';
                        }
                    });
                }
                
                // 单条计算
                function calculateSingle() {
                    // 添加计算状态提示
                    const resultsElement = document.getElementById('single-results');
                    resultsElement.style.opacity = '0.7';
                    
                    // 获取缴费基数比例
                    const basePercent = parseFloat(document.getElementById('base-percent').value) / 100;
                    
                    // 获取当前时间
                    const currentYear = parseInt(document.getElementById('single-current-year').value);
                    const currentMonth = parseInt(document.getElementById('single-current-month').value);
                    const currentDate = new Date(currentYear, currentMonth - 1, 1); // 使用自定义当前时间
                    
                    let unitPayment = 0;
                    let personalPayment = 0;
                    let lateFee = 0;
                    
                    // 获取所有时间段
                    const periodContainers = document.querySelectorAll('#periods-container .period-container');
                    
                    // 计算每个时间段
                    periodContainers.forEach(container => {
                        const periodId = container.id.split('-')[1];
                        
                        // 获取开始和结束时间
                        const startYear = parseInt(document.getElementById(`start-year-${periodId}`).value);
                        const startMonth = parseInt(document.getElementById(`start-month-${periodId}`).value);
                        const endYear = parseInt(document.getElementById(`end-year-${periodId}`).value);
                        const endMonth = parseInt(document.getElementById(`end-month-${periodId}`).value);
                        
                        // 格式化为日期格式
                        const startDate = new Date(startYear, startMonth - 1, 1);
                        const endDate = new Date(endYear, endMonth - 1, 1);
                        
                        // 遍历时间段内的每个月
                        const currentMonthIter = new Date(startDate);
                        while (currentMonthIter <= endDate) {
                            const year = currentMonthIter.getFullYear();
                            const month = currentMonthIter.getMonth() + 1;
                            
                            // 查找对应的缴费数据
                            const data = allData.find(d => 
                                d.year === year && 
                                month >= d.startMonth && 
                                month <= d.endMonth
                            );
                            
                            if (data) {
                                // 计算调整后的基数
                                const adjustedBase = data.base * basePercent;
                                
                                // 计算单位部分和个人部分
                                const unit = adjustedBase * data.unitRate;
                                const personal = adjustedBase * data.personalRate;
                                const total = unit + personal;
                                
                                unitPayment += unit;
                                personalPayment += personal;
                                
                                // 计算滞纳金
                                const lateFeeStart = new Date(year, month, 1); // 次月1日
                                const daysLate = Math.max(0, Math.floor((currentDate - lateFeeStart) / (1000 * 60 * 60 * 24)));
                                const dailyLateFeeRate = 0.0005; // 日万分之五
                                let fee = total * dailyLateFeeRate * daysLate;
                                
                                // 滞纳金不超过本金
                                fee = Math.min(fee, total);
                                
                                lateFee += fee;
                            }
                            
                            // 增加一个月
                            currentMonthIter.setMonth(currentMonthIter.getMonth() + 1);
                        }
                    });
                    
                    // 更新结果显示
                    document.getElementById('unit-payment').innerHTML = unitPayment.toFixed(2) + '<span class="result-unit">元</span>';
                    document.getElementById('personal-payment').innerHTML = personalPayment.toFixed(2) + '<span class="result-unit">元</span>';
                    document.getElementById('late-fee').innerHTML = lateFee.toFixed(2) + '<span class="result-unit">元</span>';
                    
                    const totalPayment = unitPayment + personalPayment + lateFee;
                    document.getElementById('total-payment').innerHTML = totalPayment.toFixed(2) + '<span class="result-unit">元</span>';
                    
                    // 计算完成后恢复不透明度
                    setTimeout(() => {
                        resultsElement.style.opacity = '1';
                    }, 300);
                }
                
                // 下载模板（改为Excel格式）
                function downloadTemplate() {
                    try {
                        // 创建工作簿
                        const wb = XLSX.utils.book_new();
                        
                        // 创建示例数据
                        const data = [
                            ["姓名", "开始时间", "结束时间"],
                            ["张三", "199601", "200012"],
                            ["李四", "201001", "201512"],
                            ["王五", "202001", "202412"]
                        ];
                        
                        // 创建工作表
                        const ws = XLSX.utils.aoa_to_sheet(data);
                        
                        // 将工作表添加到工作簿
                        XLSX.utils.book_append_sheet(wb, ws, "补缴人员名单");
                        
                        // 导出Excel文件
                        XLSX.writeFile(wb, "养老保险补缴批量计算模板.xlsx");
                        
                        alert("Excel模板下载成功！");
                    } catch (error) {
                        console.error("模板下载失败:", error);
                        alert("模板下载失败: " + error.message);
                    }
                }
                
                // 处理上传的文件（支持Excel和CSV格式）
                function handleFile(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const status = document.getElementById('upload-status');
                    status.className = "status-indicator status-waiting";
                    status.innerHTML = `<i class="fas fa-sync-alt fa-spin status-icon"></i> <span>正在处理文件...</span>`;
                    
                    const reader = new FileReader();
                    
                    // 根据文件类型选择读取方式
                    if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                        // Excel文件处理
                        reader.onload = function(e) {
                            try {
                                const data = new Uint8Array(e.target.result);
                                const workbook = XLSX.read(data, {type: 'array'});
                                
                                // 获取第一个工作表
                                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                                
                                // 将工作表转换为JSON
                                const jsonData = XLSX.utils.sheet_to_json(firstSheet, {header: 1});
                                
                                // 检查是否有表头
                                let hasHeader = false;
                                if (jsonData.length > 0) {
                                    const firstRow = jsonData[0];
                                    if (firstRow.some(cell => typeof cell === 'string' && 
                                        (cell.includes('姓名') || cell.toLowerCase().includes('name')))) {
                                        hasHeader = true;
                                    }
                                }
                                
                                // 处理数据
                                uploadedData = [];
                                const startLine = hasHeader ? 1 : 0;
                                
                                for (let i = startLine; i < jsonData.length; i++) {
                                    const row = jsonData[i];
                                    if (row && row.length >= 3) {
                                        // 格式化日期（兼容Excel日期格式）
                                        const formatDate = (dateValue) => {
                                            if (!dateValue) return "";
                                            if (typeof dateValue === 'number') {
                                                // 可能是Excel序列号日期格式
                                                if (dateValue > 10000) {
                                                    // 可能是YYYYMM格式
                                                    const dateStr = String(dateValue);
                                                    if (dateStr.length === 6) {
                                                        return dateStr.substring(0,4) + '-' + dateStr.substring(4,6);
                                                    }
                                                }
                                                // 尝试Excel序列号日期转换
                                                try {
                                                    const date = XLSX.SSF.parse_date_code(dateValue);
                                                    return `${date.y}-${String(date.m).padStart(2, '0')}`;
                                                } catch (e) {
                                                    return String(dateValue);
                                                }
                                            }
                                            if (typeof dateValue === 'string') {
                                                if (/^\d{6}$/.test(dateValue)) {
                                                    return dateValue.substring(0,4) + '-' + dateValue.substring(4,6);
                                                }
                                                return dateValue;
                                            }
                                            return "";
                                        };

                                        uploadedData.push({
                                            name: row[0] || "",
                                            startDate: formatDate(row[1]) || "",
                                            endDate: formatDate(row[2]) || ""
                                        });
                                    }
                                }
                                
                                // 更新状态
                                status.className = "status-indicator status-success";
                                status.innerHTML = `<i class="fas fa-check-circle status-icon"></i> <span>成功上传 ${uploadedData.length} 条记录</span>`;
                                
                                // 启用计算按钮
                                document.getElementById('batch-calculate-btn').disabled = false;
                                
                            } catch (error) {
                                console.error(error);
                                status.className = "status-indicator status-error";
                                status.innerHTML = `<i class="fas fa-exclamation-circle status-icon"></i> <span>文件解析错误: ${error.message}</span>`;
                            }
                        };
                        reader.readAsArrayBuffer(file);
                    } else {
                        // CSV文件处理
                        reader.onload = function(e) {
                            try {
                                let text = e.target.result;
                                // 去除UTF-8 BOM
                                if (text.charCodeAt(0) === 0xFEFF) {
                                    text = text.substring(1);
                                }
                                
                                // 简化的CSV解析 - 直接按行分割
                                const lines = text.split(/\r?\n/).filter(line => line.trim() !== '');
                                
                                // 检查是否有表头
                                let hasHeader = false;
                                if (lines.length > 0) {
                                    const firstLine = lines[0].toLowerCase();
                                    if (firstLine.includes('姓名') || firstLine.includes('name')) {
                                        hasHeader = true;
                                    }
                                }
                                
                                // 处理数据
                                uploadedData = [];
                                const startLine = hasHeader ? 1 : 0;
                                
                                for (let i = startLine; i < lines.length; i++) {
                                    const line = lines[i];
                                    const cells = line.split(',').map(cell => cell.trim().replace(/^"|"$/g, ''));
                                    
                                    if (cells.length >= 3) {
                                        // 格式化日期（兼容199601格式）
                                        const formatDate = (dateValue) => {
                                            if (!dateValue) return "";
                                            if (typeof dateValue === 'number') {
                                                dateValue = String(dateValue);
                                            }
                                            if (/^\d{6}$/.test(dateValue)) {
                                                return dateValue.substring(0,4) + '-' + dateValue.substring(4,6);
                                            }
                                            return dateValue;
                                        };

                                        uploadedData.push({
                                            name: cells[0] || "",
                                            startDate: formatDate(cells[1]) || "",
                                            endDate: formatDate(cells[2]) || ""
                                        });
                                    }
                                }
                                
                                // 更新状态
                                status.className = "status-indicator status-success";
                                status.innerHTML = `<i class="fas fa-check-circle status-icon"></i> <span>成功上传 ${uploadedData.length} 条记录</span>`;
                                
                                // 启用计算按钮
                                document.getElementById('batch-calculate-btn').disabled = false;
                                
                            } catch (error) {
                                console.error(error);
                                status.className = "status-indicator status-error";
                                status.innerHTML = `<i class="fas fa-exclamation-circle status-icon"></i> <span>文件解析错误: ${error.message}</span>`;
                            }
                        };
                        reader.readAsText(file);
                    }
                }
                
                // 批量计算
                function batchCalculate() {
                    if (uploadedData.length === 0) {
                        alert('没有可计算的数据');
                        return;
                    }
                    
                    // 获取基数比例
                    const basePercent = parseFloat(document.getElementById('batch-base-percent').value) / 100;
                    
                    // 获取当前时间
                    const currentYear = parseInt(document.getElementById('batch-current-year').value);
                    const currentMonth = parseInt(document.getElementById('batch-current-month').value);
                    const currentDate = new Date(currentYear, currentMonth - 1, 1); // 使用自定义当前时间
                    
                    // 处理每条记录
                    processedResults = [];
                    
                    for (let i = 0; i < uploadedData.length; i++) {
                        const item = uploadedData[i];
                        try {
                            // 验证日期格式
                            if (!/^\d{4}-\d{2}$/.test(item.startDate) || !/^\d{4}-\d{2}$/.test(item.endDate)) {
                                throw new Error(`日期格式错误: ${item.startDate} 或 ${item.endDate}`);
                            }
                            
                            const result = calculatePeriod(item.startDate, item.endDate, basePercent, currentDate);
                            processedResults.push({
                                name: item.name,
                                period: `${item.startDate.replace(/-/g, "")} 至 ${item.endDate.replace(/-/g, "")}`,
                                unitPayment: result.unitPayment,
                                personalPayment: result.personalPayment,
                                lateFee: result.lateFee,
                                total: result.unitPayment + result.personalPayment + result.lateFee
                            });
                        } catch (error) {
                            console.error(`计算第${i+1}条记录时出错:`, error);
                            processedResults.push({
                                name: item.name,
                                period: "计算错误",
                                unitPayment: 0,
                                personalPayment: 0,
                                lateFee: 0,
                                total: 0,
                                error: error.message
                            });
                        }
                    }
                    
                    // 显示结果
                    showResults();
                    
                    // 显示结果容器
                    document.getElementById('batch-results').style.display = 'block';
                    document.getElementById('record-count').textContent = processedResults.length;
                }
                
                // 计算单个时间段
                function calculatePeriod(startDateStr, endDateStr, basePercent, currentDate) {
                    // 将字符串转换为日期对象
                    const startDateParts = startDateStr.split('-');
                    const endDateParts = endDateStr.split('-');
                    
                    const startDate = new Date(parseInt(startDateParts[0]), parseInt(startDateParts[1]) - 1, 1);
                    const endDate = new Date(parseInt(endDateParts[0]), parseInt(endDateParts[1]) - 1, 1);
                    
                    // 验证日期有效性
                    if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
                        throw new Error(`无效的日期格式: ${startDateStr} 或 ${endDateStr}`);
                    }
                    
                    let unitPayment = 0;
                    let personalPayment = 0;
                    let lateFee = 0;
                    
                    // 遍历时间段内的每个月
                    const currentMonth = new Date(startDate);
                    while (currentMonth <= endDate) {
                        const year = currentMonth.getFullYear();
                        const month = currentMonth.getMonth() + 1;
                        
                        // 查找对应的缴费数据
                        const data = allData.find(d => 
                            d.year === year && 
                            month >= d.startMonth && 
                            month <= d.endMonth
                        );
                        
                        if (data) {
                            // 计算调整后的基数
                            const adjustedBase = data.base * basePercent;
                            
                            // 计算单位部分和个人部分
                            const unit = adjustedBase * data.unitRate;
                            const personal = adjustedBase * data.personalRate;
                            const total = unit + personal;
                            
                            unitPayment += unit;
                            personalPayment += personal;
                            
                            // 计算滞纳金
                            const lateFeeStart = new Date(year, month, 1); // 次月1日
                            const daysLate = Math.max(0, Math.floor((currentDate - lateFeeStart) / (1000 * 60 * 60 * 24)));
                            const dailyLateFeeRate = 0.0005; // 日万分之五
                            let fee = total * dailyLateFeeRate * daysLate;
                            
                            // 滞纳金不超过本金
                            fee = Math.min(fee, total);
                            
                            lateFee += fee;
                        }
                        
                        // 增加一个月
                        currentMonth.setMonth(currentMonth.getMonth() + 1);
                    }
                    
                    return {
                        unitPayment,
                        personalPayment,
                        lateFee
                    };
                }
                
                // 显示计算结果
                function showResults() {
                    const container = document.getElementById('results-table-body');
                    container.innerHTML = '';
                    
                    processedResults.forEach(result => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${result.name}</td>
                            <td>${result.period}</td>
                            <td>${result.unitPayment.toFixed(2)}</td>
                            <td>${result.personalPayment.toFixed(2)}</td>
                            <td>${result.lateFee.toFixed(2)}</td>
                            <td>${result.total.toFixed(2)}</td>
                        `;
                        container.appendChild(row);
                    });
                }
                
                // 导出计算结果（改为Excel格式）
                function exportResults() {
                    if (processedResults.length === 0) {
                        alert('没有可导出的结果');
                        return;
                    }
                    
                    try {
                        // 创建工作簿
                        const wb = XLSX.utils.book_new();
                        
                        // 准备数据
                        const data = [
                            ["姓名", "补缴时间段", "单位应缴", "个人应缴", "滞纳金", "总计"]
                        ];
                        
                        // 添加计算结果
                        processedResults.forEach(result => {
                            data.push([
                                result.name,
                                result.period,
                                result.unitPayment,
                                result.personalPayment,
                                result.lateFee,
                                result.total
                            ]);
                        });
                        
                        // 创建工作表
                        const ws = XLSX.utils.aoa_to_sheet(data);
                        
                        // 将工作表添加到工作簿
                        XLSX.utils.book_append_sheet(wb, ws, "计算结果");
                        
                        // 导出Excel文件
                        XLSX.writeFile(wb, "养老保险补缴批量计算结果.xlsx");
                        
                        alert("计算结果导出成功！");
                    } catch (error) {
                        console.error("导出失败:", error);
                        alert("导出失败: " + error.message);
                    }
                }
                
                // 添加新数据
                function addNewData() {
                    isAddingNew = true;
                    currentEditIndex = -1;
                    
                    // 设置模态框标题
                    document.getElementById('modal-title').textContent = "添加新数据";
                    
                    // 清空表单
                    document.getElementById('edit-year').value = new Date().getFullYear();
                    document.getElementById('edit-start-month').value = 1;
                    document.getElementById('edit-end-month').value = 12;
                    document.getElementById('edit-base').value = "";
                    document.getElementById('edit-unit-rate').value = "16";
                    document.getElementById('edit-personal-rate').value = "8";
                    
                    // 隐藏删除按钮
                    document.getElementById('modal-delete-btn').style.display = 'none';
                    
                    // 显示模态框
                    document.getElementById('edit-modal').classList.add('active');
                    
                    // 设置焦点
                    setTimeout(() => {
                        document.getElementById('edit-year').focus();
                    }, 100);
                }
                
                // 显示编辑模态框
                function showEditModal(index) {
                    const data = allData[index];
                    currentEditIndex = index;
                    isAddingNew = false;
                    
                    // 设置模态框标题
                    document.getElementById('modal-title').textContent = "编辑缴费数据";
                    
                    // 填充表单数据
                    document.getElementById('edit-year').value = data.year;
                    document.getElementById('edit-start-month').value = data.startMonth;
                    document.getElementById('edit-end-month').value = data.endMonth;
                    document.getElementById('edit-base').value = data.base;
                    document.getElementById('edit-unit-rate').value = (data.unitRate * 100).toFixed(2);
                    document.getElementById('edit-personal-rate').value = (data.personalRate * 100).toFixed(2);
                    
                    // 显示或隐藏删除按钮
                    if (data.isSystem) {
                        document.getElementById('modal-delete-btn').style.display = 'none';
                    } else {
                        document.getElementById('modal-delete-btn').style.display = 'inline-block';
                    }
                    
                    // 显示模态框
                    document.getElementById('edit-modal').classList.add('active');
                    
                    // 设置焦点
                    setTimeout(() => {
                        document.getElementById('edit-base').focus();
                    }, 100);
                }
                
                // 隐藏编辑模态框
                function hideEditModal() {
                    document.getElementById('edit-modal').classList.remove('active');
                    currentEditIndex = -1;
                    isAddingNew = false;
                    setTimeout(() => {
                        document.activeElement.blur();
                    }, 300);
                }
                
                // 确认编辑数据
                function confirmEditData() {
                    const year = parseInt(document.getElementById('edit-year').value);
                    const startMonth = parseInt(document.getElementById('edit-start-month').value);
                    const endMonth = parseInt(document.getElementById('edit-end-month').value);
                    const base = parseFloat(document.getElementById('edit-base').value);
                    const unitRate = parseFloat(document.getElementById('edit-unit-rate').value) / 100;
                    const personalRate = parseFloat(document.getElementById('edit-personal-rate').value) / 100;
                    
                    // 验证输入
                    if (isNaN(year) || isNaN(startMonth) || isNaN(endMonth) || isNaN(base) || isNaN(unitRate) || isNaN(personalRate)) {
                        alert('请填写有效的数值');
                        return;
                    }
                    
                    if (startMonth < 1 || startMonth > 12 || endMonth < 1 || endMonth > 12) {
                        alert('月份必须在1-12之间');
                        return;
                    }
                    
                    if (isAddingNew) {
                        // 添加新数据
                        allData.push({
                            year,
                            startMonth,
                            endMonth,
                            base,
                            unitRate,
                            personalRate,
                            isSystem: false
                        });
                    } else {
                        // 更新现有数据
                        const data = allData[currentEditIndex];
                        data.year = year;
                        data.startMonth = startMonth;
                        data.endMonth = endMonth;
                        data.base = base;
                        data.unitRate = unitRate;
                        data.personalRate = personalRate;
                        
                        // 如果是系统数据，将其转换为自定义数据
                        if (data.isSystem) {
                            data.isSystem = false;
                        }
                    }
                    
                    // 保存到本地存储
                    saveAllData();
                    
                    // 更新表格
                    updateDataTable();
                    
                    // 隐藏模态框
                    hideEditModal();
                    
                    alert('数据已成功' + (isAddingNew ? '添加' : '更新') + '！');
                }
                
                // 删除数据
                function deleteData() {
                    if (confirm('确定要删除这条数据吗？')) {
                        allData.splice(currentEditIndex, 1);
                        // 保存到本地存储
                        saveAllData();
                        updateDataTable();
                        hideEditModal();
                    }
                }
                
                // 重置系统数据
                function resetSystemData() {
                    if (confirm('确定要重置系统数据吗？这将恢复所有系统数据到初始状态，但会保留您的自定义数据。')) {
                        // 移除所有系统数据
                        allData = allData.filter(item => !item.isSystem);
                        
                        // 添加默认系统数据
                        allData = [...allData, ...defaultSystemData];
                        
                        // 保存到本地存储
                        saveAllData();
                        
                        // 更新表格
                        updateDataTable();
                        
                        alert('系统数据已成功重置！');
                    }
                }
                
                // 清除缓存功能
                function clearCache() {
                    if (confirm('确定要清除所有缓存数据吗？这将删除所有自定义数据并恢复到系统默认状态。')) {
                        // 清除本地存储
                        localStorage.removeItem('pension_all_data');
                        
                        // 重新加载默认数据
                        allData = [...defaultSystemData];
                        saveAllData();
                        
                        // 更新表格
                        updateDataTable();
                        
                        alert('缓存已成功清除，已恢复到系统默认数据！');
                    }
                }
                
                // 更新数据表格
                function updateDataTable() {
                    const tableBody = document.getElementById('data-table-body');
                    tableBody.innerHTML = '';
                    
                    // 按年份排序
                    const sortedData = [...allData].sort((a, b) => a.year - b.year);
                    
                    // 添加所有数据
                    sortedData.forEach((data, index) => {
                        const row = document.createElement('tr');
                        if (data.isSystem) {
                            row.classList.add('system-data-row');
                        }
                        
                        row.innerHTML = `
                            <td>${data.year}</td>
                            <td>${data.startMonth}</td>
                            <td>${data.endMonth}</td>
                            <td>${data.base}</td>
                            <td>${(data.unitRate * 100).toFixed(2)}%</td>
                            <td>${(data.personalRate * 100).toFixed(2)}%</td>
                            <td>${data.isSystem ? '系统数据' : '自定义数据'}</td>
                            <td>
                                <button class="btn edit-system-btn" data-index="${index}">
                                    <i class="fas fa-edit"></i> 编辑
                                </button>
                                ${!data.isSystem ? 
                                    `<button class="btn delete-btn" style="padding: 8px 12px; font-size: 14px; background: #e74c3c; margin-left: 5px;" data-index="${index}">
                                        <i class="fas fa-trash"></i> 删除
                                    </button>` : ''
                                }
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                    
                    // 为编辑按钮添加事件监听器
                    document.querySelectorAll('.edit-system-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const index = parseInt(this.getAttribute('data-index'));
                            showEditModal(index);
                        });
                    });
                    
                    // 为删除按钮添加事件监听器
                    document.querySelectorAll('.delete-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const index = parseInt(this.getAttribute('data-index'));
                            if (confirm('确定要删除这条数据吗？')) {
                                allData.splice(index, 1);
                                saveAllData();
                                updateDataTable();
                            }
                        });
                    });
                }
                
                // 添加时间段
                function addPeriod() {
                    periodCounter++;
                    const periodsContainer = document.getElementById('periods-container');
                    
                    const periodHTML = `
                        <div class="period-container" id="period-${periodCounter}">
                            <div class="period-header">
                                <div class="period-title">补缴时间段 #${periodCounter}</div>
                                <button class="remove-period">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="time-inputs">
                                <div class="time-input-group">
                                    <div class="time-input-box">
                                        <label for="start-year-${periodCounter}">开始年份</label>
                                        <input type="number" id="start-year-${periodCounter}"min="1990" max="2050" value="2001" class="date-input year-input" maxlength="4">
                                    </div>
                                    <div class="time-input-box">
                                        <label for "start-month-${periodCounter}">开始月份</label>
                                        <input type="number" id="start-month-${periodCounter}" min="1" max="12" value="1" class="date-input month-input" maxlength="2">
                                    </div>
                                </div>
                                <div class="time-input-group">
                                    <div class="time-input-box">
                                        <label for="end-year-${periodCounter}">结束年份</label>
                                        <input type="number" id="end-year-${periodCounter}"min="1990" max="2050" value="2010" class="date-input year-input" maxlength="4">
                                    </div>
                                    <div class="time-input-box">
                                        <label for="end-month-${periodCounter}">结束月份</label>
                                        <input type="number" id="end-month-${periodCounter}" min="1" max="12" value="12" class="date-input month-input" maxlength="2">
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // 使用insertAdjacentHTML插入新时间段
                    const addButton = document.querySelector('.add-period-btn');
                    periodsContainer.insertAdjacentHTML('beforeend', periodHTML);
                    
                    // 显示第一个时间段的删除按钮
                    if (periodCounter > 1) {
                        document.querySelector('#period-1 .remove-period').style.display = 'block';
                    }
                    
                    // 设置新时间段的输入框自动跳转
                    setupDateInputs();
                    
                    // 为新的删除按钮绑定事件
                    setupRemovePeriodButtons();
                }
                
                // 设置删除时间段按钮
                function setupRemovePeriodButtons() {
                    document.querySelectorAll('.remove-period').forEach(button => {
                        button.addEventListener('click', function() {
                            const container = this.closest('.period-container');
                            const periodId = container.id.split('-')[1];
                            removePeriod(periodId);
                        });
                    });
                }
                
                // 删除时间段
                function removePeriod(periodId) {
                    const periodContainer = document.getElementById(`period-${periodId}`);
                    if (periodContainer) {
                        periodContainer.remove();
                        periodCounter--;
                        
                        // 更新剩余时间段的标题
                        const remainingPeriods = document.querySelectorAll('#periods-container .period-container');
                        remainingPeriods.forEach((container, index) => {
                            const title = container.querySelector('.period-title');
                            title.textContent = `补缴时间段 #${index + 1}`;
                            
                            // 更新ID
                            container.id = `period-${index + 1}`;
                            
                            // 更新输入框ID
                            const inputs = container.querySelectorAll('input');
                            inputs.forEach(input => {
                                const idParts = input.id.split('-');
                                idParts[2] = index + 1;
                                input.id = idParts.join('-');
                            });
                        });
                        
                        // 如果只剩一个时间段，隐藏删除按钮
                        if (remainingPeriods.length === 1) {
                            document.querySelector('.remove-period').style.display = 'none';
                        }
                        
                        // 重新绑定删除按钮事件
                        setupRemovePeriodButtons();
                    }
                }
                
                // 自定义基数计算
                function calculateCustomBase() {
                    // 添加计算状态提示
                    const resultsElement = document.getElementById('custom-results');
                    resultsElement.style.opacity = '0.7';
                    
                    // 获取当前时间
                    const currentYear = parseInt(document.getElementById('custom-current-year').value);
                    const currentMonth = parseInt(document.getElementById('custom-current-month').value);
                    const currentDate = new Date(currentYear, currentMonth - 1, 1); // 使用自定义当前时间
                    
                    let unitPayment = 0;
                    let personalPayment = 0;
                    let lateFee = 0;
                    
                    // 获取所有时间段
                    const periodContainers = document.querySelectorAll('#custom-periods-container .period-container');
                    
                    // 计算每个时间段
                    periodContainers.forEach(container => {
                        // 直接通过容器查询输入框
                        const startYear = parseInt(container.querySelector('input[class*="year-input"][id^="custom-start-year"]').value);
                        const startMonth = parseInt(container.querySelector('input[class*="month-input"][id^="custom-start-month"]').value);
                        const endYear = parseInt(container.querySelector('input[class*="year-input"][id^="custom-end-year"]').value);
                        const endMonth = parseInt(container.querySelector('input[class*="month-input"][id^="custom-end-month"]').value);
                        
                        // 获取该时间段的基数
                        const periodBase = parseFloat(container.querySelector('input[id^="custom-base"]').value);
                        if (isNaN(periodBase)) {
                            return; // 跳过无效基数
                        }
                        
                        // 格式化为日期格式
                        const startDate = new Date(startYear, startMonth - 1, 1);
                        const endDate = new Date(endYear, endMonth - 1, 1);
                        
                        // 验证时间段是否超过12个月
                        const monthsDiff = (endDate.getFullYear() - startDate.getFullYear()) * 12 + 
                                          (endDate.getMonth() - startDate.getMonth()) + 1;
                        
                        if (monthsDiff > 12) {
                            return; // 跳过无效时间段
                        }
                        
                        // 遍历时间段内的每个月
                        const currentMonthIter = new Date(startDate);
                        while (currentMonthIter <= endDate) {
                            const year = currentMonthIter.getFullYear();
                            const month = currentMonthIter.getMonth() + 1;
                            
                            // 查找对应的缴费数据（仅使用比例）
                            const data = allData.find(d => 
                                d.year === year && 
                                month >= d.startMonth && 
                                month <= d.endMonth
                            );
                            
                            if (data) {
                                // 使用该时间段的基数
                                const adjustedBase = periodBase;
                                
                                // 计算单位部分和个人部分
                                const unit = adjustedBase * data.unitRate;
                                const personal = adjustedBase * data.personalRate;
                                const total = unit + personal;
                                
                                unitPayment += unit;
                                personalPayment += personal;
                                
                                // 计算滞纳金
                                const lateFeeStart = new Date(year, month, 1); // 次月1日
                                const daysLate = Math.max(0, Math.floor((currentDate - lateFeeStart) / (1000 * 60 * 60 * 24)));
                                const dailyLateFeeRate = 0.0005; // 日万分之五
                                let fee = total * dailyLateFeeRate * daysLate;
                                
                                // 滞纳金不超过本金
                                fee = Math.min(fee, total);
                                
                                lateFee += fee;
                            }
                            
                            // 增加一个月
                            currentMonthIter.setMonth(currentMonthIter.getMonth() + 1);
                        }
                    });
                    
                    // 更新结果显示
                    document.getElementById('custom-unit-payment').innerHTML = unitPayment.toFixed(2) + '<span class="result-unit">元</span>';
                    document.getElementById('custom-personal-payment').innerHTML = personalPayment.toFixed(2) + '<span class="result-unit">元</span>';
                    document.getElementById('custom-late-fee').innerHTML = lateFee.toFixed(2) + '<span class="result-unit">元</span>';
                    
                    const totalPayment = unitPayment + personalPayment + lateFee;
                    document.getElementById('custom-total-payment').innerHTML = totalPayment.toFixed(2) + '<span class="result-unit">元</span>';
                    
                    // 计算完成后恢复不透明度
                    setTimeout(() => {
                        resultsElement.style.opacity = '1';
                    }, 300);
                }
                
                // 添加自定义时间段
                function addCustomPeriod() {
                    customPeriodCounter++;
                    const periodsContainer = document.getElementById('custom-periods-container');
                    
                    const periodHTML = `
                        <div class="period-container" id="custom-period-${customPeriodCounter}">
                            <div class="period-header">
                                <div class="period-title">补缴时间段 #${customPeriodCounter}</div>
                                <button class="remove-period">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="time-inputs">
                                <div class="time-input-group">
                                    <div class="time-input-box">
                                        <label for="custom-start-year-${customPeriodCounter}">开始年份</label>
                                        <input type="number" id="custom-start-year-${customPeriodCounter}"min="1990" max="2050" value="2021" class="date-input year-input" maxlength="4">
                                    </div>
                                    <div class="time-input-box">
                                        <label for="custom-start-month-${customPeriodCounter}">开始月份</label>
                                        <input type="number" id="custom-start-month-${customPeriodCounter}" min="1" max="12" value="1" class="date-input month-input" maxlength="2">
                                    </div>
                                </div>
                                <div class="time-input-group">
                                    <div class="time-input-box">
                                        <label for="custom-end-year-${customPeriodCounter}">结束年份</label>
                                        <input type="number" id="custom-end-year-${customPeriodCounter}"min="1990" max="2050" value="2021" class="date-input year-input" maxlength="4">
                                    </div>
                                    <div class="time-input-box">
                                        <label for="custom-end-month-${customPeriodCounter}">结束月份</label>
                                        <input type="number" id="custom-end-month-${customPeriodCounter}" min="1, max="12" value="12" class="date-input month-input" maxlength="2">
                                    </div>
                                </div>
                                <div class="time-input-group">
                                    <div class="time-input-box">
                                        <label for="custom-base-${customPeriodCounter}">月缴费基数（元）</label>
                                        <input type="number" id="custom-base-${customPeriodCounter}" min="1000" step="100" value="5000" class="custom-base-input">
                                    </div>
                                </div>
                            </div>
                            <div class="error-message" id="custom-period-error-${customPeriodCounter}"></div>
                        </div>
                    `;
                    
                    // 使用insertAdjacentHTML插入新时间段
                    const addButton = document.querySelector('#custom-base-tool-content .add-period-btn');
                    periodsContainer.insertAdjacentHTML('beforeend', periodHTML);
                    
                    // 显示第一个时间段的删除按钮
                    if (customPeriodCounter > 1) {
                        document.querySelector('#custom-period-1 .remove-period').style.display = 'block';
                    }
                    
                    // 设置新时间段的输入框自动跳转
                    setupDateInputs();
                    
                    // 添加时间验证
                    setupCustomDateValidation();
                    
                    // 为新的删除按钮绑定事件
                    setupRemoveCustomPeriodButtons();
                }
                
                // 设置删除自定义时间段按钮
                function setupRemoveCustomPeriodButtons() {
                    document.querySelectorAll('#custom-periods-container .remove-period').forEach(button => {
                        button.addEventListener('click', function() {
                            const container = this.closest('.period-container');
                            const periodId = container.id.split('-')[2];
                            removeCustomPeriod(periodId);
                        });
                    });
                }
                
                // 删除自定义时间段
                function removeCustomPeriod(periodId) {
                    const periodContainer = document.getElementById(`custom-period-${periodId}`);
                    if (periodContainer) {
                        periodContainer.remove();
                        customPeriodCounter--;
                        
                        // 更新剩余时间段的标题
                        const remainingPeriods = document.querySelectorAll('#custom-periods-container .period-container');
                        remainingPeriods.forEach((container, index) => {
                            const title = container.querySelector('.period-title');
                            title.textContent = `补缴时间段 #${index + 1}`;
                            
                            // 更新ID
                            container.id = `custom-period-${index + 1}`;
                            
                            // 更新输入框ID
                            const inputs = container.querySelectorAll('input');
                            inputs.forEach(input => {
                                const idParts = input.id.split('-');
                                idParts[3] = index + 1;
                                input.id = idParts.join('-');
                            });
                            
                            // 更新错误消息ID
                            const error = container.querySelector('.error-message');
                            error.id = `custom-period-error-${index + 1}`;
                        });
                        
                        // 如果只剩一个时间段，隐藏删除按钮
                        if (remainingPeriods.length === 1) {
                            document.querySelector('#custom-period-1 .remove-period').style.display = 'none';
                        }
                        
                        // 重新绑定删除按钮事件
                        setupRemoveCustomPeriodButtons();
                    }
                }
                
                // 设置自定义时间段验证
                function setupCustomDateValidation() {
                    const inputs = document.querySelectorAll('#custom-periods-container input');
                    
                    inputs.forEach(input => {
                        input.addEventListener('change', function() {
                            const idParts = this.id.split('-');
                            const periodId = idParts[3];
                            
                            // 获取开始和结束时间
                            const startYear = document.getElementById(`custom-start-year-${periodId}`).value;
                            const startMonth = document.getElementById(`custom-start-month-${periodId}`).value;
                            const endYear = document.getElementById(`custom-end-year-${periodId}`).value;
                            const endMonth = document.getElementById(`custom-end-month-${periodId}`).value;
                            
                            // 验证输入是否完整
                            if (startYear && startMonth && endYear && endMonth) {
                                const startDate = new Date(`${startYear}-${startMonth.padStart(2, '0')}-01`);
                                const endDate = new Date(`${endYear}-${endMonth.padStart(2, '0')}-01`);
                                
                                // 计算月份差
                                const monthsDiff = (endDate.getFullYear() - startDate.getFullYear()) * 12 + 
                                                  (endDate.getMonth() - startDate.getMonth()) + 1;
                                
                                const errorElement = document.getElementById(`custom-period-error-${periodId}`);
                                
                                if (monthsDiff > 12) {
                                    errorElement.textContent = '错误：时间段不能超过12个月';
                                    errorElement.style.display = 'block';
                                } else if (monthsDiff < 1) {
                                    errorElement.textContent = '错误：结束时间不能早于开始时间';
                                    errorElement.style.display = 'block';
                                } else {
                                    errorElement.style.display = 'none';
                                }
                            }
                        });
                    });
                }
                
                // 设置日期输入框自动跳转
                function setupDateInputs() {
                    // 获取所有日期输入框
                    const dateInputs = document.querySelectorAll('.date-input');
                    
                    dateInputs.forEach((input, index) => {
                        // 添加输入事件监听
                        input.addEventListener('input', function() {
                            const maxLength = this.classList.contains('year-input') ? 4 : 2;
                            
                            // 检查是否达到最大长度
                            if (this.value.length >= maxLength) {
                                // 找到下一个输入框
                                const nextInput = dateInputs[index + 1];
                                if (nextInput) {
                                    nextInput.focus();
                                    nextInput.select();
                                }
                            }
                        });
                        
                        // 添加键盘事件监听（按回车跳转）
                        input.addEventListener('keydown', function(e) {
                            if (e.key === 'Enter') {
                                const nextInput = dateInputs[index + 1];
                                if (nextInput) {
                                    nextInput.focus();
                                    nextInput.select();
                                    e.preventDefault();
                                }
                            }
                        });
                    });
                }
                
                // 工伤保险功能
                function initInjuryInsurance() {
                    const periodsContainer = document.getElementById('injuryPeriodsContainer');
                    const addPeriodBtn = document.getElementById('injuryAddPeriod');
                    const calculateBtn = document.getElementById('injuryCalculateBtn');
                    const currentYearInput = document.getElementById('injury-current-year');
                    const currentMonthInput = document.getElementById('injury-current-month');
                    const periodSummary = document.getElementById('injuryPeriodSummary');
                    const monthList = document.getElementById('injuryMonthList');
                    
                    // 设置当前日期为默认值
                    const today = new Date();
                    currentYearInput.value = today.getFullYear();
                    currentMonthInput.value = today.getMonth() + 1;
                    
                    // 添加时间段
                    let injuryPeriodCounter = 1;
                    
                    addPeriodBtn.addEventListener('click', function() {
                        injuryPeriodCounter++;
                        const periodRow = document.createElement('div');
                        periodRow.className = 'injury-period-row';
                        periodRow.innerHTML = `
                            <div class="injury-period-inputs">
                                <div class="time-input-group">
                                    <div class="time-input-box">
                                        <label for="injury-start-year-${injuryPeriodCounter}">开始年份</label>
                                        <input type="number" id="injury-start-year-${injuryPeriodCounter}" min="1990" max="2050" value="2023" class="date-input year-input" maxlength="4">
                                    </div>
                                    <div class="time-input-box">
                                        <label for="injury-start-month-${injuryPeriodCounter}">开始月份</label>
                                        <input type="number" id="injury-start-month-${injuryPeriodCounter}" min="1" max="12" value="1" class="date-input month-input" maxlength="2">
                                    </div>
                                </div>
                                <div class="time-input-group">
                                    <div class="time-input-box">
                                        <label for="injury-end-year-${injuryPeriodCounter}">结束年份</label>
                                        <input type="number" id="injury-end-year-${injuryPeriodCounter}" min="1990" max="2050" value="2023" class="date-input year-input" maxlength="4">
                                    </div>
                                    <div class="time-input-box">
                                        <label for="injury-end-month-${injuryPeriodCounter}">结束月份</label>
                                        <input type="number" id="injury-end-month-${injuryPeriodCounter}" min="1" max="12" value="12" class="date-input month-input" maxlength="2">
                                    </div>
                                </div>
                                <div class="time-input-group">
                                    <div class="time-input-box">
                                        <label for="injury-base-${injuryPeriodCounter}">缴费基数</label>
                                        <input type="number" id="injury-base-${injuryPeriodCounter}" class="injury-period-base" min="0" step="0.01" placeholder="例如：5000" value="5000" required>
                                    </div>
                                    <div class="time-input-box">
                                        <label for="injury-rate-${injuryPeriodCounter}">征缴比例 (%)</label>
                                        <input type="number" id="injury-rate-${injuryPeriodCounter}" class="injury-period-rate" min="0" max="10" step="0.01" placeholder="例如：0.5" value="0.5" required>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="injury-remove-period">删除</button>
                        `;
                        
                        periodsContainer.appendChild(periodRow);
                        
                        // 设置新时间段的开始时间为上一个时间段的结束时间的下一个月
                        const previousPeriod = periodsContainer.children[periodsContainer.children.length - 2];
                        if (previousPeriod) {
                            const prevEndYear = previousPeriod.querySelector('.injury-period-inputs .time-input-group:nth-child(2) .year-input').value;
                            const prevEndMonth = previousPeriod.querySelector('.injury-period-inputs .time-input-group:nth-child(2) .month-input').value;
                            
                            if (prevEndYear && prevEndMonth) {
                                let nextYear = parseInt(prevEndYear);
                                let nextMonth = parseInt(prevEndMonth) + 1;
                                
                                if (nextMonth > 12) {
                                    nextMonth = 1;
                                    nextYear++;
                                }
                                
                                periodRow.querySelector('.injury-period-inputs .time-input-group:nth-child(1) .year-input').value = nextYear;
                                periodRow.querySelector('.injury-period-inputs .time-input-group:nth-child(1) .month-input').value = nextMonth;
                            }
                        }
                        
                        // 为新的删除按钮绑定事件
                        periodRow.querySelector('.injury-remove-period').addEventListener('click', function() {
                            if (periodsContainer.children.length > 1) {
                                periodsContainer.removeChild(periodRow);
                                injuryPeriodCounter--;
                            }
                        });
                        
                        // 设置新输入框的自动跳转
                        setupDateInputs();
                    });
                    
                    // 初始时间段的删除事件
                    document.querySelector('.injury-remove-period').addEventListener('click', function() {
                        if (periodsContainer.children.length > 1) {
                            periodsContainer.removeChild(periodsContainer.children[0]);
                            injuryPeriodCounter--;
                        }
                    });
                    
                    // 计算按钮事件
                    calculateBtn.addEventListener('click', function() {
                        const currentYear = currentYearInput.value;
                        const currentMonth = currentMonthInput.value.padStart(2, '0');
                        if (!currentYear || !currentMonth) {
                            alert('请填写当前年份和月份');
                            return;
                        }
                        
                        const currentDateStr = `${currentYear}-${currentMonth}`;
                        
                        const periodRows = periodsContainer.getElementsByClassName('injury-period-row');
                        if (periodRows.length === 0) {
                            alert('请至少添加一个补缴时间段');
                            return;
                        }
                        
                        // 收集所有时间段数据
                        const periods = [];
                        let hasError = false;
                        
                        for (let i = 0; i < periodRows.length; i++) {
                            const row = periodRows[i];
                            const startYear = row.querySelector('.injury-period-inputs .time-input-group:nth-child(1) .year-input').value;
                            const startMonth = row.querySelector('.injury-period-inputs .time-input-group:nth-child(1) .month-input').value.padStart(2, '0');
                            const endYear = row.querySelector('.injury-period-inputs .time-input-group:nth-child(2) .year-input').value;
                            const endMonth = row.querySelector('.injury-period-inputs .time-input-group:nth-child(2) .month-input').value.padStart(2, '0');
                            const baseAmount = parseFloat(row.querySelector('.injury-period-base').value);
                            const rate = parseFloat(row.querySelector('.injury-period-rate').value);
                            
                            if (!startYear || !startMonth || !endYear || !endMonth || isNaN(baseAmount) || isNaN(rate)) {
                                hasError = true;
                                break;
                            }
                            
                            const startDateStr = `${startYear}-${startMonth}`;
                            const endDateStr = `${endYear}-${endMonth}`;
                            
                            if (startDateStr > endDateStr) {
                                alert(`时间段 ${i+1} 的开始时间不能晚于结束时间`);
                                hasError = true;
                                break;
                            }
                            
                            periods.push({
                                startMonth: startDateStr,
                                endMonth: endDateStr,
                                baseAmount: baseAmount,
                                rate: rate / 100 // 转换为小数
                            });
                        }
                        
                        if (hasError) {
                            alert('请填写完整的时间段信息');
                            return;
                        }
                        
                        // 计算补缴金额和滞纳金
                        calculateInjuryPayment(periods, currentDateStr);
                    });
                    
                    // 计算函数
                    function calculateInjuryPayment(periods, currentMonth) {
                        let totalMonths = 0;
                        let totalAmount = 0;
                        let totalLateFee = 0;
                        let monthDetails = [];
                        
                        // 计算每个时间段的应缴金额和滞纳金
                        periods.forEach((period, index) => {
                            // 获取时间段内的所有月份
                            const months = getMonthsBetween(period.startMonth, period.endMonth);
                            totalMonths += months.length;
                            
                            // 计算每个月的应缴金额和滞纳金
                            months.forEach(month => {
                                // 计算该月应缴金额
                                const amount = period.baseAmount * period.rate;
                                totalAmount += amount;
                                
                                // 计算滞纳金
                                const lateFeeInfo = calculateInjuryLateFee(month, currentMonth, amount);
                                totalLateFee += lateFeeInfo.fee;
                                
                                // 保存月份明细
                                monthDetails.push({
                                    month: month,
                                    base: period.baseAmount,
                                    rate: period.rate * 100, // 转回百分比
                                    amount: amount,
                                    lateDays: lateFeeInfo.days,
                                    lateFee: lateFeeInfo.fee
                                });
                            });
                        });
                        
                        // 显示结果
                        document.getElementById('injury-monthsCount').textContent = totalMonths;
                        document.getElementById('injury-totalAmount').innerHTML = totalAmount.toFixed(2) + '<span class="result-unit">元</span>';
                        
                        // 只显示滞纳金金额，不显示滞纳金天数
                        document.getElementById('injury-lateFee').innerHTML = totalLateFee.toFixed(2) + '<span class="result-unit">元</span>';
                        document.getElementById('injury-totalPayment').innerHTML = (totalAmount + totalLateFee).toFixed(2) + '<span class="result-unit">元</span>';
                        
                        // 显示月份明细
                        displayInjuryMonthDetails(monthDetails);
                    }
                    
                    // 获取两个月份之间的所有月份
                    function getMonthsBetween(startMonth, endMonth) {
                        const months = [];
                        const [startYear, startMonthNum] = startMonth.split('-').map(Number);
                        const [endYear, endMonthNum] = endMonth.split('-').map(Number);
                        
                        let year = startYear;
                        let month = startMonthNum;
                        
                        while (year < endYear || (year === endYear && month <= endMonthNum)) {
                            months.push(`${year}-${month.toString().padStart(2, '0')}`);
                            
                            month++;
                            if (month > 12) {
                                month = 1;
                                year++;
                            }
                        }
                        
                        return months;
                    }
                    
                    // 计算滞纳金
                    function calculateInjuryLateFee(month, currentMonth, amount) {
                        // 将月份字符串转换为日期对象（设置为该月的第一天）
                        const monthDate = new Date(month + '-01');
                        // 欠缴次月第一天开始计算滞纳金
                        const lateStartDate = new Date(monthDate);
                        lateStartDate.setMonth(lateStartDate.getMonth() + 1);
                        lateStartDate.setDate(1);
                        
                        // 结束日期（当前月份的第一天）
                        const endDate = new Date(currentMonth + '-01');
                        
                        // 计算天数差
                        const timeDiff = endDate.getTime() - lateStartDate.getTime();
                        const daysDiff = Math.max(0, Math.ceil(timeDiff / (1000 * 3600 * 24)));
                        
                        // 计算滞纳金（日万分之五）
                        const lateFee = amount * daysDiff * 0.0005;
                        
                        return {
                            days: daysDiff,
                            fee: lateFee
                        };
                    }
                    
                    // 显示月份明细
                    function displayInjuryMonthDetails(monthDetails) {
                        // 移除"暂无数据"提示
                        const noData = monthList.querySelector('.injury-no-data');
                        if (noData) {
                            monthList.removeChild(noData);
                        }
                        
                        // 保留表头，移除其他内容
                        const header = monthList.querySelector('.injury-summary-header');
                        monthList.innerHTML = '';
                        monthList.appendChild(header);
                        
                        // 添加月份明细
                        monthDetails.forEach(detail => {
                            const monthItem = document.createElement('div');
                            monthItem.className = 'injury-month-item';
                            monthItem.innerHTML = `
                                <span>${detail.month}</span>
                                <span>${detail.base.toFixed(2)} 元</span>
                                <span>${detail.rate.toFixed(2)} %</span>
                                <span>${detail.amount.toFixed(2)} 元</span>
                                <span>${detail.lateFee.toFixed(2)} 元</span>
                            `;
                            monthList.appendChild(monthItem);
                        });
                        
                        periodSummary.style.display = 'block';
                    }
                    
                    // 设置日期输入框自动跳转
                    setupDateInputs();
                }
                
                // 格式化日期为YYYY年MM月DD日
                function formatDate(date) {
                    const year = date.getFullYear();
                    const month = (date.getMonth() + 1).toString().padStart(2, '0');
                    const day = date.getDate().toString().padStart(2, '0');
                    return `${year}年${month}月${day}日`;
                }
                
                // 文件上传处理
                const fileInput = document.getElementById('file-input');
                const uploadArea = document.getElementById('upload-area');
                
                // 点击上传区域触发文件选择
                uploadArea.addEventListener('click', () => {
                    fileInput.click();
                });
                
                // 文件选择变化
                fileInput.addEventListener('change', handleFile);
                
                // 拖拽功能
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.style.borderColor = '#2980b9';
                    uploadArea.style.backgroundColor = '#e6f7ff';
                });
                
                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.style.borderColor = '#3498db';
                    uploadArea.style.backgroundColor = '#f8fafc';
                });
                
                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.style.borderColor = '#3498db';
                    uploadArea.style.backgroundColor = '#f8fafc';
                    
                    if (e.dataTransfer.files.length) {
                        fileInput.files = e.dataTransfer.files;
                        handleFile({ target: { files: e.dataTransfer.files } });
                    }
                });
                
                // 设置自定义时间段验证
                setupCustomDateValidation();
                
                // 设置日期输入框自动跳转
                setupDateInputs();
                
                // 设置当前年月监听器
                setupCurrentDateListeners();
                
                // 设置当前日期
                const currentDate = new Date();
                document.getElementById('data-update-date').textContent = formatDate(currentDate);
                
                // 绑定所有按钮事件
                document.querySelectorAll('.btn-calculate').forEach(btn => {
                    if (btn.id === 'batch-calculate-btn') {
                        btn.addEventListener('click', batchCalculate);
                    } else if (btn.closest('#single-tool-content')) {
                        btn.addEventListener('click', calculateSingle);
                    } else if (btn.closest('#custom-base-tool-content')) {
                        btn.addEventListener('click', calculateCustomBase);
                    }
                });
                
                document.getElementById('download-template-btn').addEventListener('click', downloadTemplate);
                document.getElementById('export-results-btn').addEventListener('click', exportResults);
                document.getElementById('add-data-btn').addEventListener('click', addNewData);
                document.getElementById('reset-system-data-btn').addEventListener('click', resetSystemData);
                document.getElementById('clear-cache-btn').addEventListener('click', clearCache);
                document.querySelector('.add-period-btn').addEventListener('click', addPeriod);
                document.querySelector('#custom-base-tool-content .add-period-btn').addEventListener('click', addCustomPeriod);
                
                // 为删除按钮绑定事件
                setupRemovePeriodButtons();
                setupRemoveCustomPeriodButtons();
                
                // 模态框事件绑定
                document.querySelector('.modal-close').addEventListener('click', hideEditModal);
                document.querySelector('.modal-btn-cancel').addEventListener('click', hideEditModal);
                document.querySelector('.modal-btn-confirm').addEventListener('click', confirmEditData);
                document.getElementById('modal-delete-btn').addEventListener('click', deleteData);
                
                // 点击模态框外部关闭
                document.getElementById('edit-modal').addEventListener('click', function(e) {
                    if (e.target === this) {
                        hideEditModal();
                    }
                });
                
                // 初始化工伤保险功能
                initInjuryInsurance();
                
                // 初始化时更新数据表格
                updateDataTable();
            }
        });
    </script>
</body>
</html>